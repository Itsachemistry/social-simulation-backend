# ç¤¾äº¤ä»¿çœŸå¼•æ“å­¦ä¹ æ£€æŸ¥æ¸…å•
## ğŸ“‹ å­¦ä¹ è¿›åº¦è·Ÿè¸ª

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¦‚å¿µç†è§£ âœ…

#### 1.1 é¡¹ç›®æ¶æ„ç†è§£
- [ ] ç†è§£å››ä¸ªæ ¸å¿ƒæ¨¡å—çš„èŒè´£åˆ†å·¥
- [ ] æŒæ¡æ—¶é—´ç‰‡æœºåˆ¶çš„å·¥ä½œåŸç†
- [ ] ç†è§£Agentç±»å‹å’Œä¼˜å…ˆçº§
- [ ] ç†è§£ä¸ªæ€§åŒ–ä¿¡æ¯æµçš„æ¦‚å¿µ

#### 1.2 æ ¸å¿ƒæ¦‚å¿µæŒæ¡
- [ ] æ—¶é—´ç‰‡ (Time Slice)
- [ ] Agentç±»å‹ï¼šæ„è§é¢†è¢–ã€è§„åˆ™Agentã€æ™®é€šç”¨æˆ·
- [ ] ä¸–ç•ŒçŠ¶æ€ (World State)
- [ ] ä¸ªæ€§åŒ–ä¿¡æ¯æµ (Personalized Feed)
- [ ] çªå‘äº‹ä»¶æ³¨å…¥ (Event Injection)

### ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒæ¨¡å—å­¦ä¹ 

#### 2.1 æ—¶é—´ç®¡ç†å™¨ (`time_manager.py`) âœ…
- [ ] ç†è§£ `__init__` æ–¹æ³•çš„å‚æ•°å’Œé€»è¾‘
- [ ] æŒæ¡ `get_slice()` æ–¹æ³•çš„å·¥ä½œåŸç†
- [ ] ç†è§£å¸–å­æ’åºæœºåˆ¶
- [ ] æŒæ¡æ—¶é—´ç‰‡è®¡ç®—é€»è¾‘

**å…³é”®ä»£ç ç†è§£**ï¼š
```python
# æŒ‰æ—¶é—´æˆ³æ’åºå¸–å­
self._posts = sorted(posts, key=lambda x: x['timestamp'])

# è®¡ç®—æ€»æ—¶é—´ç‰‡æ•°
self._total_slices = (len(self._posts) + slice_size - 1) // slice_size
```

#### 2.2 ä¸–ç•ŒçŠ¶æ€ç®¡ç†å™¨ (`world_state.py`) âœ…
- [ ] ç†è§£å¸–å­æ•°æ®ç»“æ„
- [ ] æŒæ¡ `add_post()` æ–¹æ³•çš„é€»è¾‘
- [ ] ç†è§£ `inject_event()` çš„ç‰¹æ®Šå¤„ç†
- [ ] æŒæ¡å¸–å­æ± ç®¡ç†æœºåˆ¶

**å…³é”®ä»£ç ç†è§£**ï¼š
```python
# å¸–å­æ•°æ®ç»“æ„
{
    "id": str,              # å¸–å­å”¯ä¸€æ ‡è¯†ç¬¦
    "content": str,         # å¸–å­å†…å®¹
    "author_id": str,       # ä½œè€…ID
    "timestamp": str,       # ISOæ ¼å¼æ—¶é—´æˆ³
    "heat": int,           # çƒ­åº¦å€¼ (0-100)
    "likes": int,          # ç‚¹èµæ•°
    "shares": int,         # åˆ†äº«æ•°
    "is_event": bool,      # æ˜¯å¦ä¸ºçªå‘äº‹ä»¶
    "priority": int        # ä¼˜å…ˆçº§
}
```

#### 2.3 Agentç±» (`agent.py`) ğŸ”„
- [ ] ç†è§£Agentçš„çŠ¶æ€å±æ€§ï¼ˆæƒ…ç»ªã€ç½®ä¿¡åº¦ã€ç²¾åŠ›ï¼‰
- [ ] æŒæ¡ `update_state()` æ–¹æ³•çš„çŠ¶æ€æ›´æ–°é€»è¾‘
- [ ] ç†è§£ `_calculate_post_impact()` çš„å½±å“è®¡ç®—
- [ ] æŒæ¡ `generate_action_prompt()` çš„å†³ç­–é€»è¾‘
- [ ] ç†è§£å…´è¶£åŒ¹é…å’Œç«‹åœºç›¸ä¼¼åº¦è®¡ç®—

**å…³é”®æ¦‚å¿µ**ï¼š
- **æƒ…ç»ªå€¼** (emotion): 0-1ï¼Œè¡¨ç¤ºAgentçš„æ­£é¢/è´Ÿé¢æƒ…ç»ª
- **ç½®ä¿¡åº¦** (confidence): 0-1ï¼Œè¡¨ç¤ºAgentå¯¹å½“å‰ä¿¡æ¯çš„ä¿¡ä»»ç¨‹åº¦
- **ç²¾åŠ›å€¼** (energy): 0-1ï¼Œè¡¨ç¤ºAgentçš„è¡ŒåŠ¨èƒ½åŠ›
- **ç«‹åœºå€¼** (stance): 0-1ï¼Œè¡¨ç¤ºAgentçš„æ”¿æ²»/ç¤¾ä¼šç«‹åœº

#### 2.4 Agentæ§åˆ¶å™¨ (`agent_controller.py`) ğŸ”„
- [ ] ç†è§£Agentåˆ†ç»„å’Œä¼˜å…ˆçº§æœºåˆ¶
- [ ] æŒæ¡ `run_time_slice()` çš„è°ƒåº¦é€»è¾‘
- [ ] ç†è§£ `_generate_personalized_feed()` çš„ç­›é€‰ç®—æ³•
- [ ] æŒæ¡ä¸ªæ€§åŒ–ä¿¡æ¯æµçš„ä¸‰ä¸ªç­›é€‰æ¡ä»¶
- [ ] ç†è§£Agentè¡ŒåŠ¨æ‰§è¡Œæµç¨‹

**å…³é”®ç®—æ³•ç†è§£**ï¼š
```python
# 1. çƒ­åº¦ç­›é€‰
if post_heat < heat_threshold:
    continue

# 2. ç«‹åœºç›¸ä¼¼åº¦ç­›é€‰
similarity_score = self._calculate_stance_similarity(agent, post)
if similarity_score < similarity_threshold:
    continue

# 3. å…´è¶£åŒ¹é…ç­›é€‰
if not self._check_interest_match(agent, post):
    continue
```

### ç¬¬ä¸‰é˜¶æ®µï¼šæœåŠ¡å±‚ç†è§£

#### 3.1 LLMæœåŠ¡ (`llm_service.py`)
- [ ] ç†è§£LLMæœåŠ¡çš„æŠ½è±¡è®¾è®¡
- [ ] æŒæ¡Mockæ¨¡å¼å’ŒçœŸå®APIæ¨¡å¼çš„åŒºåˆ«
- [ ] ç†è§£Promptç”Ÿæˆå’Œå†…å®¹ç”Ÿæˆæµç¨‹

#### 3.2 æ•°æ®æœåŠ¡ (`services.py`)
- [ ] ç†è§£æ•°æ®åŠ è½½å™¨çš„è®¾è®¡
- [ ] æŒæ¡é…ç½®æ–‡ä»¶è§£æé€»è¾‘
- [ ] ç†è§£é”™è¯¯å¤„ç†æœºåˆ¶

### ç¬¬å››é˜¶æ®µï¼šä¸»ç¨‹åºç†è§£

#### 4.1 ä»¿çœŸå¼•æ“ (`main.py`)
- [ ] ç†è§£ `SimulationEngine` ç±»çš„åˆå§‹åŒ–æµç¨‹
- [ ] æŒæ¡ `run_simulation()` çš„ä¸»å¾ªç¯é€»è¾‘
- [ ] ç†è§£æ¨¡å—é—´çš„åè°ƒæœºåˆ¶
- [ ] æŒæ¡ç»“æœæ”¶é›†å’Œä¿å­˜é€»è¾‘

**å…³é”®æµç¨‹ç†è§£**ï¼š
```python
# ä¸»ä»¿çœŸå¾ªç¯
while self.current_slice < self.total_slices:
    # 1. è·å–å½“å‰æ—¶é—´ç‰‡å¸–å­
    current_slice_posts = self.time_manager.get_slice(self.current_slice)
    
    # 2. è·å–æ‰€æœ‰å†å²å¸–å­
    all_posts = self.world_state.get_all_posts()
    
    # 3. æ‰§è¡Œæ—¶é—´ç‰‡è°ƒåº¦
    slice_results = self.agent_controller.run_time_slice(
        current_slice_posts, all_posts
    )
    
    # 4. è®°å½•ç»“æœ
    self.simulation_results.append({...})
    
    # 5. ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡
    self.current_slice += 1
```

### ç¬¬äº”é˜¶æ®µï¼šå®è·µå’Œè°ƒè¯•

#### 5.1 è¿è¡Œç¤ºä¾‹
- [ ] æˆåŠŸè¿è¡Œ `test_with_config.py`
- [ ] ç†è§£è¾“å‡ºç»“æœçš„å«ä¹‰
- [ ] åˆ†æAgentè¡Œä¸ºæ¨¡å¼
- [ ] è§‚å¯Ÿæ—¶é—´ç‰‡æ¨è¿›è¿‡ç¨‹

#### 5.2 é…ç½®ç†è§£
- [ ] ç†è§£ `config/agents.json` çš„é…ç½®ç»“æ„
- [ ] æŒæ¡ä¸åŒç±»å‹Agentçš„å‚æ•°è®¾ç½®
- [ ] ç†è§£LLMé…ç½®é€‰é¡¹

#### 5.3 è°ƒè¯•æŠ€å·§
- [ ] å­¦ä¼šä½¿ç”¨printè¯­å¥è°ƒè¯•
- [ ] ç†è§£æ—¥å¿—è¾“å‡ºçš„å«ä¹‰
- [ ] æŒæ¡é”™è¯¯å®šä½æ–¹æ³•

### ç¬¬å…­é˜¶æ®µï¼šæ·±å…¥ç†è§£

#### 6.1 ç®—æ³•æ·±å…¥
- [ ] ç†è§£ä¸ªæ€§åŒ–ä¿¡æ¯æµçš„æƒé‡è®¡ç®—
- [ ] æŒæ¡AgentçŠ¶æ€æ›´æ–°çš„æ•°å­¦åŸç†
- [ ] ç†è§£æ—¶é—´ç‰‡è°ƒåº¦çš„ä¼˜åŒ–ç­–ç•¥

#### 6.2 æ‰©å±•æ€è€ƒ
- [ ] å¦‚ä½•æ·»åŠ æ–°çš„Agentç±»å‹ï¼Ÿ
- [ ] å¦‚ä½•ä¼˜åŒ–ä¸ªæ€§åŒ–æ¨èç®—æ³•ï¼Ÿ
- [ ] å¦‚ä½•å¢åŠ æ›´å¤æ‚çš„äº¤äº’æœºåˆ¶ï¼Ÿ
- [ ] å¦‚ä½•æé«˜ä»¿çœŸæ€§èƒ½ï¼Ÿ

## ğŸ¯ å­¦ä¹ ç›®æ ‡

### çŸ­æœŸç›®æ ‡ (1-2å‘¨)
- [ ] èƒ½å¤Ÿç†è§£æ‰€æœ‰æ ¸å¿ƒæ¨¡å—çš„ä»£ç é€»è¾‘
- [ ] èƒ½å¤Ÿè¿è¡Œå’Œè°ƒè¯•ä»¿çœŸç¨‹åº
- [ ] èƒ½å¤Ÿä¿®æ”¹Agenté…ç½®å’Œå‚æ•°
- [ ] èƒ½å¤Ÿåˆ†æä»¿çœŸç»“æœ

### ä¸­æœŸç›®æ ‡ (1ä¸ªæœˆ)
- [ ] èƒ½å¤Ÿæ·»åŠ æ–°çš„Agentç±»å‹
- [ ] èƒ½å¤Ÿä¼˜åŒ–ä¸ªæ€§åŒ–æ¨èç®—æ³•
- [ ] èƒ½å¤Ÿæ‰©å±•ä»¿çœŸåŠŸèƒ½
- [ ] èƒ½å¤Ÿå¤„ç†å¤§è§„æ¨¡æ•°æ®

### é•¿æœŸç›®æ ‡ (2-3ä¸ªæœˆ)
- [ ] èƒ½å¤Ÿè®¾è®¡æ–°çš„ä»¿çœŸåœºæ™¯
- [ ] èƒ½å¤Ÿä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½
- [ ] èƒ½å¤Ÿé›†æˆæ–°çš„AIæ¨¡å‹
- [ ] èƒ½å¤Ÿè¿›è¡Œå­¦æœ¯ç ”ç©¶

## ğŸ“ å­¦ä¹ ç¬”è®°æ¨¡æ¿

### æ¨¡å—å­¦ä¹ ç¬”è®°
```
æ¨¡å—åç§°ï¼š___________
å­¦ä¹ æ—¥æœŸï¼š___________

#### æ ¸å¿ƒåŠŸèƒ½
- åŠŸèƒ½1ï¼š___________
- åŠŸèƒ½2ï¼š___________

#### å…³é”®æ–¹æ³•
- æ–¹æ³•1ï¼š___________
  - å‚æ•°ï¼š___________
  - è¿”å›å€¼ï¼š___________
  - é€»è¾‘ï¼š___________

#### é‡è¦æ¦‚å¿µ
- æ¦‚å¿µ1ï¼š___________
- æ¦‚å¿µ2ï¼š___________

#### ç–‘é—®å’Œæ€è€ƒ
- é—®é¢˜1ï¼š___________
- é—®é¢˜2ï¼š___________

#### å®è·µå¿ƒå¾—
- å¿ƒå¾—1ï¼š___________
- å¿ƒå¾—2ï¼š___________
```

## ğŸ” å¸¸è§é—®é¢˜è§£ç­”

### Q1: å¦‚ä½•ç†è§£æ—¶é—´ç‰‡æœºåˆ¶ï¼Ÿ
A: æ—¶é—´ç‰‡æ˜¯å°†è¿ç»­æ—¶é—´ç¦»æ•£åŒ–å¤„ç†çš„æ–¹æ³•ã€‚æ¯ä¸ªæ—¶é—´ç‰‡åŒ…å«å›ºå®šæ•°é‡çš„å¸–å­ï¼Œä»¿çœŸæŒ‰æ—¶é—´ç‰‡é¡ºåºæ¨è¿›ï¼Œæ¯ä¸ªæ—¶é—´ç‰‡å†…æ‰€æœ‰Agentä¾æ¬¡è¡ŒåŠ¨ã€‚

### Q2: ä¸ªæ€§åŒ–ä¿¡æ¯æµæ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼Ÿ
A: é€šè¿‡ä¸‰ä¸ªç­›é€‰æ¡ä»¶ï¼š1) çƒ­åº¦ç­›é€‰ï¼ˆå¸–å­çƒ­åº¦è¾¾åˆ°é˜ˆå€¼ï¼‰ï¼Œ2) ç«‹åœºç›¸ä¼¼åº¦ç­›é€‰ï¼ˆå¸–å­ä¸Agentç«‹åœºç›¸ä¼¼ï¼‰ï¼Œ3) å…´è¶£åŒ¹é…ç­›é€‰ï¼ˆå¸–å­åŒ¹é…Agentå…´è¶£ï¼‰ã€‚

### Q3: Agentçš„çŠ¶æ€æ˜¯å¦‚ä½•æ›´æ–°çš„ï¼Ÿ
A: Agentæ ¹æ®æ¥æ”¶åˆ°çš„å¸–å­è®¡ç®—å½±å“å€¼ï¼Œæ›´æ–°æƒ…ç»ªã€ç½®ä¿¡åº¦å’Œç²¾åŠ›ã€‚å½±å“å€¼åŸºäºå¸–å­çƒ­åº¦ã€ç«‹åœºç›¸ä¼¼åº¦å’Œå…´è¶£åŒ¹é…åº¦è®¡ç®—ã€‚

### Q4: å¦‚ä½•æ·»åŠ æ–°çš„Agentç±»å‹ï¼Ÿ
A: 1) åœ¨Agenté…ç½®ä¸­æ·»åŠ æ–°ç±»å‹ï¼Œ2) åœ¨AgentControllerä¸­æ·»åŠ æ–°ç±»å‹çš„å¤„ç†é€»è¾‘ï¼Œ3) è®¾ç½®æ–°ç±»å‹çš„ä¼˜å…ˆçº§å’Œå‚æ•°ã€‚

## ğŸ“š æ¨èå­¦ä¹ èµ„æº

1. **PythonåŸºç¡€**ï¼šç¡®ä¿æŒæ¡ç±»ã€ç»§æ‰¿ã€è£…é¥°å™¨ç­‰æ¦‚å¿µ
2. **æ•°æ®ç»“æ„**ï¼šç†è§£åˆ—è¡¨ã€å­—å…¸ã€é›†åˆçš„ä½¿ç”¨
3. **ç®—æ³•åŸºç¡€**ï¼šäº†è§£æ’åºã€æœç´¢ã€ç­›é€‰ç®—æ³•
4. **è®¾è®¡æ¨¡å¼**ï¼šç†è§£å·¥å‚æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ç­‰
5. **ä»¿çœŸç†è®º**ï¼šäº†è§£ç¦»æ•£äº‹ä»¶ä»¿çœŸçš„åŸºæœ¬åŸç† 

## 2024-06-09 Agentå½±å“è¿½è¸ªä¸parent_post_idæ ‡å‡†åŒ–å®ç°è®°å½•

### ä¸»è¦å†…å®¹
1. æ ‡å‡†åŒ–äº†Agentåœ¨æ¯ä¸ªæ—¶é—´ç‰‡å†…å¯¹æ¯æ¡å¸–å­å½±å“åˆ†æ•°çš„è®¡ç®—æ–¹å¼ï¼š
   - å½±å“åˆ†æ•° = abs(delta_emotion) + abs(delta_confidence)
   - åœ¨update_stateä¸­è‡ªåŠ¨è¿½è¸ªæœ¬æ—¶é—´ç‰‡å½±å“æœ€å¤§çš„å¸–å­IDï¼ˆmax_impact_post_idï¼‰åŠå…¶åˆ†æ•°ã€‚
2. ä¼˜åŒ–äº†update_stateçš„è¿”å›å€¼ï¼Œæ˜ç¡®åŒ…å«delta_emotionã€delta_confidenceï¼Œä¾¿äºä¸»æµç¨‹è¿½è¸ªã€‚
3. å»ºè®®åœ¨Agentç”Ÿæˆæ–°å¸–å­æ—¶ï¼Œparent_post_idåº”æŒ‡å‘max_impact_post_idï¼Œå®ç°ä¼ æ’­æ ‘çš„åˆç†è¿æ¥ã€‚

### è®¾è®¡æ€è·¯
- å¸–å­çš„æƒ…æ„Ÿå’Œç«‹åœºåœ¨ä»¿çœŸå‰å·²ç”±LLM+äººå·¥æ ‡æ³¨ï¼Œä»¿çœŸè¿‡ç¨‹ä¸­ç›´æ¥è¯»å–ã€‚
- Agentæ¯å¤„ç†ä¸€æ¡å¸–å­ï¼Œéƒ½ä¼šè°ƒç”¨update_stateï¼Œè‡ªåŠ¨è®¡ç®—å¹¶è®°å½•æœ¬æ¬¡çŠ¶æ€å˜åŒ–é‡ã€‚
- å½±å“åˆ†æ•°ç”¨äºè¿½è¸ªæœ¬æ—¶é—´ç‰‡å†…å¯¹Agentå½±å“æœ€å¤§çš„å¸–å­ï¼Œä¾¿äºåç»­ç”Ÿæˆæ–°å¸–æ—¶ä½œä¸ºparent_post_idã€‚
- è¯¥æœºåˆ¶å¡«è¡¥äº†è®ºæ–‡ä¸­"Agentæ–°å‘å¸–åº”å›å¤è°"è¿™ä¸€å®ç°ç»†èŠ‚çš„ç©ºç™½ï¼Œä¿è¯äº†ä¼ æ’­é“¾è·¯çš„åˆç†æ€§å’Œå¯è¿½æº¯æ€§ã€‚

### åç»­å»ºè®®
- å¯åœ¨AgentåŸºç±»ä¸­è¿›ä¸€æ­¥æ¨¡æ¿åŒ–"åšå®š/ä¸åšå®š"ç«‹åœºæ›´æ–°è§„åˆ™ï¼Œä¾¿äºå¼€å‘è€…å¤ç”¨ã€‚
- å¯åœ¨ä¸»æµç¨‹ä¸­è‡ªåŠ¨å°†æ–°å¸–parent_post_idèµ‹å€¼ä¸ºmax_impact_post_idã€‚ 